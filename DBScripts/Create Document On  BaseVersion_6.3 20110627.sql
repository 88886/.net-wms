
--文档管理      
-- Create table文档目录结构      
create table TBLDOCDIR
(
  DIRSERIAL   NUMBER(22) not null,
  DIRNAME     VARCHAR2(40) not null,
  PDIRSERIAL  NUMBER(8) not null,
  DIRDESC   VARCHAR2(100) ,
  DIRSEQ   NUMBER(8) not null,
  MUSER       VARCHAR2(40) not null,
  MDATE       NUMBER(8) not null,
  MTIME       NUMBER(6) not null
);


-- Create/Recreate primary, unique and foreign key constraints 
alter table TBLDOCDIR  
  add constraint TBLDOCDIR_PK primary key (DIRSERIAL);


-- Create sequence 
create sequence TBLDOCDIR_ID_S
minvalue 1
maxvalue 999999999999999999999999999
start with 141
increment by 1
cache 20;

-- Create TRIGGER 
CREATE OR REPLACE TRIGGER TBLDOCDIR_BRI1
  BEFORE INSERT ON TBLDOCDIR
  REFERENCING NEW AS NEW OLD AS OLD
  FOR EACH ROW
BEGIN
  SELECT TBLDOCDIR_id_s.NEXTVAL INTO :NEW.DIRSERIAL FROM DUAL;
END;

-- Create 文档目录结构对应的用户组权限       
create table TBLDOCDIR2USERGROUP
(
  DIRSERIAL   NUMBER(22) not null,
  USERGROUPCODE     VARCHAR2(40) not null,
  DIRTYPE  VARCHAR2(40) not null,
  MUSER       VARCHAR2(40) not null,
  MDATE       NUMBER(8) not null,
  MTIME       NUMBER(6) not null
);

-- Create/Recreate primary, unique and foreign key constraints 
alter table TBLDOCDIR2USERGROUP  
  add constraint TBLDOCDIR2USERGROUP_PK primary key (DIRSERIAL,USERGROUPCODE,DIRTYPE);


-- Create table文档      
create table TBLDOC
(
  DOCSERIAL   NUMBER(22) not null,
  DIRSERIAL   NUMBER(22) not null,
  DOCNAME     VARCHAR2(100) not null,
  DOCNUM      VARCHAR2(100) not null,  
  DOCVER     VARCHAR2(40) ,
  DOCCHGNUM  VARCHAR2(100),
  DOCCHGFILE   VARCHAR2(100) ,
  ITEMLIST   VARCHAR2(4000) ,
  OPLIST   VARCHAR2(4000) ,
  MEMO   VARCHAR2(2000) ,
  KEYWORD   VARCHAR2(2000) ,
  CHECKEDSTATUS  VARCHAR2(40) default 'N' not null,
  VALIDSTATUS  VARCHAR2(40)  default 'N' not null,
  DOCTYPE   VARCHAR2(40) ,
  UPUSER       VARCHAR2(40) not null,
  UPFILEDATE        NUMBER(8) not null,
  SERVERFileName VARCHAR2(200) ,
  MUSER       VARCHAR2(40) not null,
  MDATE       NUMBER(8) not null,
  MTIME       NUMBER(6) not null
);  
              
-- Create/Recreate primary, unique and foreign key constraints 
alter table TBLDOC  
  add constraint TBLDOC_PK primary key (DOCSERIAL);
              
-- Create sequence 
create sequence TBLDOC_ID_S
minvalue 1
maxvalue 999999999999999999999999999
start with 141
increment by 1
cache 20;

-- Create TRIGGER 
CREATE OR REPLACE TRIGGER TBLDOC_BRI1
  BEFORE INSERT ON TBLDOC
  REFERENCING NEW AS NEW OLD AS OLD
  FOR EACH ROW
BEGIN
  SELECT TBLDOC_ID_S.NEXTVAL INTO :NEW.DOCSERIAL FROM DUAL;
END;

--group 文档类型
insert into tblsysparamgroup (PARAMGROUPCODE, PARAMGROUPTYPE, PARAMGROUPDESC, MUSER, MDATE, MTIME, ISSYS, EATTRIBUTE1)
values ('DOCTYPEGROUP', 'DOCTYPEGROUP', '文档类型', 'ADMIN', 20110318, 195854, '0', '');

insert into tblsysparam (PARAMCODE, PARAMGROUPCODE, PARAMALIAS, PARAMDESC, PARAMVALUE, MUSER, MDATE, MTIME, ISACTIVE, ISSYS, EATTRIBUTE1, PARENTPARAM)
values ('DOCSYSTYPE', 'DOCTYPEGROUP', 'SYS', '系统类型', '', 'ADMIN', 20110318, 200019, '0', '0', '1', '');

--group 文档路径
insert into tblsysparamgroup (PARAMGROUPCODE, PARAMGROUPTYPE, PARAMGROUPDESC, MUSER, MDATE, MTIME, ISSYS, EATTRIBUTE1)
values ('DOCDIRPATHGROUP', 'DOCDIRPATHGROUP', '文档目录路径', 'ADMIN', 20110320, 104040, '0', '');

insert into tblsysparam (PARAMCODE, PARAMGROUPCODE, PARAMALIAS, PARAMDESC, PARAMVALUE, MUSER, MDATE, MTIME, ISACTIVE, ISSYS, EATTRIBUTE1, PARENTPARAM)
values ('DOCDIRPATH', 'DOCDIRPATHGROUP', 'E:', '文档目录路径', '', 'ADMIN', 20110320, 82039, '0', '0', '1', '');

--group CS 文档发布路径

insert into tblsysparamgroup (PARAMGROUPCODE, PARAMGROUPTYPE, PARAMGROUPDESC, MUSER, MDATE, MTIME, ISSYS, EATTRIBUTE1)
values ('PUBLISHDOCDIRPATHGROUP', 'PUBLISHDOCDIRPATHGROUP', '文档发布路径', 'ADMIN', 20110320, 104040, '0', '');

insert into tblsysparam (PARAMCODE, PARAMGROUPCODE, PARAMALIAS, PARAMDESC, PARAMVALUE, MUSER, MDATE, MTIME, ISACTIVE, ISSYS, EATTRIBUTE1, PARENTPARAM)
values ('PUBLISHDOCDIRPATH', 'PUBLISHDOCDIRPATHGROUP', 'http://Hi1-ibmsv610/FileUpLoad/', '文档发布路径', '', 'ADMIN', 20110420, 144924, '0', '0', '1', '');


---文档管理模块维护----------
insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('DOCUMENT_MANAGE', '', '1.0', 'B/S', 'Alpha', '文档管理', 121, '', 'ADMIN', 20110317, 165712, '1', '1', '', '', '0');

insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('DOCUMENTVIEW', 'DOCUMENT_MANAGE', '1.0', 'B/S', 'Alpha', '文档查阅界面', 5, '', 'ADMIN', 20110318, 153808, '1', '1', 'BaseSetting/FDocView.aspx', '', '0');

insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('DOCDIR', 'DOCUMENT_MANAGE', '', 'B/S', 'Alpha', '文档目录维护', 1, '', 'ADMIN', 20110318, 162643, '1', '1', 'BaseSetting/FDocDirMP.aspx', '', '0');

insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('FILEUPLOAD', 'DOCUMENT_MANAGE', '1.0', 'B/S', 'Alpha', '文件上传', 2, '', 'ADMIN', 20110317, 203906, '1', '1', 'BaseSetting/FFileUpLoadMP.aspx', '', '0');

insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('FILECHECK', 'DOCUMENT_MANAGE', '1.0', 'B/S', 'Alpha', '文件审核', 3, '', 'ADMIN', 20110317, 203906, '1', '1', 'BaseSetting/FFileCheckMP.aspx', '', '0');


insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('DOCVIEW', 'DOC_MANAGE', '', 'C/S', 'Alpha', '文档查阅', 120, '', 'ADMIN', 20110414, 112758, '1', '1', 'BenQGuru.eMES.Client.FDocView', '', '0');

insert into tblmdl (MDLCODE, PMDLCODE, MDLVER, MDLTYPE, MDLSTATUS, MDLDESC, MDLSEQ, MDLHFNAME, MUSER, MDATE, MTIME, ISSYS, ISACTIVE, FORMURL, EATTRIBUTE1, ISRESTRAIN)
values ('DOC_MANAGE', 'CS', '', 'C/S', 'Alpha', '文档管理', 60, '', 'ADMIN', 20110414, 113317, '1', '1', '', '', '0');

---文档管理菜单维护--------------
insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('DOCUMENT_MANAGE', 'DOCUMENT_MANAGE', '', '文档管理', 45, 'B/S', 'ADMIN', 20110317, 191558, '', '0');

insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('DOCUMENTVIEW', 'DOCUMENTVIEW', 'DOCUMENT_MANAGE', '文档查阅', 5, 'B/S', 'ADMIN', 20110318, 153857, '', '0');

insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('DOCDIR', 'DOCDIR', 'DOCUMENT_MANAGE', '文档目录维护', 1, 'B/S', 'ADMIN', 20110318, 162723, '', '0');

insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('FILEUPLOAD', 'FILEUPLOAD', 'DOCUMENT_MANAGE', '文件上传', 2, 'B/S', 'ADMIN', 20110317, 191653, '', '0');

insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('FILECHECK', 'FILECHECK', 'DOCUMENT_MANAGE', '文件审核',3, 'B/S', 'ADMIN', 20110317, 191653, '', '0');


insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('DOCVIEW', 'DOCVIEW', 'DOC_MANAGE', '文档查阅', 120, 'C/S', 'ADMIN', 20110414, 113233, '', '0');

insert into tblmenu (MENUCODE, MDLCODE, PMENUCODE, MENUDESC, MENUSEQ, MENUTYPE, MUSER, MDATE, MTIME, EATTRIBUTE1, VISIBILITY)
values ('DOC_MANAGE', 'DOC_MANAGE', 'CS', '文档管理', 60, 'C/S', 'ADMIN', 20110414, 113144, '', '0');



